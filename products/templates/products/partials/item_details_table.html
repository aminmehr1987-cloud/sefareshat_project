{% load custom_filters %}

<table class="items-table">
  <thead>
    <tr>
      <th>کد کالا</th>
      <th>نام محصول</th>
      <th>تعداد درخواستی</th>
      <th>تعداد تخصیص‌یافته</th>
      <th>قیمت واحد</th>
      <th>جمع کل</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.product.code }}</td>
      <td>{{ item.product.name }}</td>
      <td>{{ item.requested_quantity }}</td>
      <td>
        {% if order.status in 'pending,warehouse,parent' %}
          <span style="color:#aaa;">-</span>
        {% else %}
          {{ item.allocated_quantity|default:"-" }}
        {% endif %}
      </td>
      <td>{{ item.price|floatformat:0|default:0 }} ریال</td>
      <td>
        {% if order.status in 'pending,warehouse,parent' %}
          <span style="color:#aaa;">-</span>
        {% else %}
          {% widthratio item.allocated_quantity|default:"0" 1 item.price %} ریال
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="6">هیچ کالایی یافت نشد.</td></tr>
    {% endfor %}
  </tbody>
</table>
