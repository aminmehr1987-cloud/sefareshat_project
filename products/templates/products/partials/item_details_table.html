{% load custom_filters %}

<style>
/* Responsive column widths for item details table */
.items-table th:nth-child(1), .items-table td:nth-child(1) { width: 15%; min-width: 80px; } /* کد کالا */
.items-table th:nth-child(2), .items-table td:nth-child(2) { width: 25%; min-width: 120px; } /* نام محصول */
.items-table th:nth-child(3), .items-table td:nth-child(3) { width: 12%; min-width: 80px; } /* تعداد درخواستی */
.items-table th:nth-child(4), .items-table td:nth-child(4) { width: 12%; min-width: 80px; } /* تعداد تخصیص یافته */
.items-table th:nth-child(5), .items-table td:nth-child(5) { width: 18%; min-width: 100px; } /* قیمت واحد */
.items-table th:nth-child(6), .items-table td:nth-child(6) { width: 18%; min-width: 100px; } /* جمع کل */

/* Mobile responsiveness */
@media (max-width: 768px) {
  .items-table th:nth-child(1), .items-table td:nth-child(1) { width: 18%; min-width: 60px; }
  .items-table th:nth-child(2), .items-table td:nth-child(2) { width: 30%; min-width: 100px; }
  .items-table th:nth-child(3), .items-table td:nth-child(3) { width: 15%; min-width: 60px; }
  .items-table th:nth-child(4), .items-table td:nth-child(4) { width: 15%; min-width: 60px; }
  .items-table th:nth-child(5), .items-table td:nth-child(5) { width: 22%; min-width: 80px; }
  .items-table th:nth-child(6), .items-table td:nth-child(6) { width: 22%; min-width: 80px; }
}
</style>

<table class="items-table">
  <thead>
    <tr>
      <th>کد کالا</th>
      <th>نام محصول</th>
      <th>تعداد درخواستی</th>
      <th>تعداد تخصیص‌یافته</th>
      <th>قیمت واحد</th>
      <th>جمع کل</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.product.code }}</td>
      <td>{{ item.product.name }}</td>
      <td>{{ item.requested_quantity }}</td>
      <td>
        {% if order.status in 'pending,warehouse,parent' %}
          <span style="color:#aaa;">-</span>
        {% else %}
          {{ item.allocated_quantity|default:"-" }}
        {% endif %}
      </td>
      <td>{{ item.price|floatformat:0|default:0 }} ریال</td>
      <td>
        {% if order.status in 'pending,warehouse,parent' %}
          <span style="color:#aaa;">-</span>
        {% else %}
          {% widthratio item.allocated_quantity|default:"0" 1 item.price %} ریال
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="6">هیچ کالایی یافت نشد.</td></tr>
    {% endfor %}
  </tbody>
</table>
